namespace Biblioteca{

public class RepositorioEmpleadoArchTexto : IRepositorioEmpleado{
        public void AgregarEmpleado(Biblioteca.Empleado empleado)
        {
            using (StreamWriter sw = new StreamWriter("Cliente.txt")){
                sw.WriteLine($"{empleado.documento}|{empleado.nombre}|{empleado.apellido}|{empleado.direccion}|{empleado.fecha_nacimiento}|{empleado.numero_legajo}|");
            }
        }


        public void EliminarEmpleado(int Dni){
            StreamWriter sw = File.CreateText("temporal.txt");
            StreamReader sr = new StreamReader("Empleado.txt");
            string? linea;
            string[] campos = new string[5];
            bool ok=false;
            while(!sr.EndOfStream){
                linea = sr.ReadLine();
                while(linea != null){
                    campos = linea.Split('|');
                }
                for(int i=0;i < campos.Length;i++){
                    if(Int32.Parse(campos[0]) == Dni){
                        ok=true;; 
                    }
                    else{
                        sw.WriteLine(linea);
                    }
                }
            }
            if(ok == false){
                Console.WriteLine("El dni no esta en el archivo");
            }
            sw.Close();
            sr.Close();
            File.Delete("Empleado.txt");
            File.Move("temporal.txt","Empleado.txt");
        }


        public Empleado? GetEmpleado(int DNI){
            StreamReader sr = new StreamReader("Empleado.txt");
            Empleado empleado = new Empleado();
            string? linea;
            string[] campos = new string[5];
            bool ok=true;
            while((!sr.EndOfStream)&&(ok==true)){
                    linea = sr.ReadLine();
                    while(linea != null){
                        campos = linea.Split('|');
                    }
                    if(Int32.Parse(campos[0]) == DNI){
                        empleado.documento=Int32.Parse(campos[0]);
                        empleado.nombre=campos[1];
                        empleado.apellido=campos[2];
                        empleado.direccion=campos[3];
                        empleado.fecha_nacimiento=DateTime.Parse(campos[4]);
                        empleado.numero_legajo=Int32.Parse(campos[5]);
                        ok=false;
                    }          
            }  
            sr.Close();  
            if(ok==true){
                return null;
            }
            else{
                return empleado;
            }
        }

        public void ModificarEmpleado(Empleado empleado)
        {
            using (StreamReader sr = new StreamReader("Empleado.txt")){
            while(!sr.EndOfStream){
                string? cadena = sr.ReadLine();
                string[] elementos = new string [6];
                while(cadena != null){
                    elementos = cadena.Split("|");
                } 
                if(empleado.documento == Int32.Parse(elementos[0])){
                    using(StreamWriter sw = new StreamWriter("Cliente.txt")){
                        sw.WriteLine($"{empleado.documento}|{empleado.nombre}|{empleado.apellido}|{empleado.direccion}|{empleado.fecha_nacimiento}|{empleado.numero_legajo}|");
                    }
                }
            }
            }
        }
   

        public List<Empleado> GetEmpleados()
        {
           List<Empleado>lista = new List<Empleado>();
            StreamReader sr = new StreamReader("Empleados.txt");
            Empleado empleado = new Empleado();
            string? linea;
            string[] campos = new string[5];
            while(!sr.EndOfStream){
                linea = sr.ReadLine();
                while(linea != null){
                    campos = linea.Split('|');
                }  
                empleado.documento=Int32.Parse(campos[0]);
                empleado.nombre=campos[1];
                empleado.apellido=campos[2];
                empleado.direccion=campos[3];
                empleado.fecha_nacimiento=DateTime.Parse(campos[4]);
                empleado.numero_legajo=Int32.Parse(campos[5]);
                lista.Add(empleado);

            }
            sr.Close();
            return lista;
        }
    }

}
